## 一、正确使用 mysql 字符集
1. 查看字符集
```
show variables like '%character%';
```
2. 查看校对规则
```
show variables like 'collation_%';
```
3. mysql 中的 utf-8 字符集是 utf8mb4
## 二、多种方式连接 mysql 数据库
1. MySQLdb 是 python2 的包，使用于 MySQL5.5 和 Python2.7
2. Python3 连接 MySQL：
   - Python3 安装的 MySQLdb 包叫做 mysqlclient，加载的依然是 MySQLdb
   - shell> pip install mysqlclient
   - python> import MySQLdb
3. 其他 DB-API：
   - shell> pip install pymysql                # 流行度最高
```
# PyMYSQL 链接 MySQL 数据库
# pip install PyMySQL

import pymysql

# 打开数据库

db = pymysql.connect("server1", "root", "passwd", "testdb")

try:
    # 使用 cursor() 方法创建一个游标对象 cursor
    with db.cursor as cursor:
        sql = '''SELECT VERSON()'''
        # 使用 execute() 方法执行 sql 查询
        cursor.execute(sql)
        result = cursor.fetchone()
    db.commit()

except Exception as e:
    print(f'fetch error {e}')

finally:
    # 关闭数据库链接
    db.close()

print(f'Database version: {result}')
```
   - shell> pip install mysql-connector-python # mysql 官方
4. 使用 ORM
   - shell> pip install sqlalchemy
```
# 直接使用 sqlalchemy 的 core 模式
# sqlalchemy 链接 mysql 数据库
# pip3 install sqlalchemy

import pymysql
from sqlalchemy import create_engine, Table, Column, Integer, String, Metadata, ForeignKey

# 打开数据库链接
# echo=True 开启调试
engine = create_engine("mysql+pymysql://root:passwd@server:3306/testdb", echo=True)

# 创建元数据
metadata = Metadata(engine)

book_table = Table('book', metadata,
    Column('id', Integer, primary_key=True),
    Column('name', String(20))
    )

author_table = Table('author', metadata,
    Column('id', Integer, primary_key=True),
    Column('book_id', None, ForeignKey('book_id')),
    Column('author_name', String(128), nullable=False)
    )

try:
    metadata.create_all()
except Exception as e:
    print(f'create error {e}')
```
```
#!/usr/bin/python3
# sqlalchemy ORM 方式连接 MySQL 数据库
# pip install sqlalchemy

import pymysql
from sqlalchemy import create_engine,Table,Column,Integer,String,MetaData,ForeignKey
from sqlalchemy.ext.declarative import declarative_base

# 打开数据库
Base = declarative_base()

class Book_table(Base):
    __tablename__ = 'bookorm'
    book_id = Column(Integer(), primary_key=True)
    book_name = Column(String(50),index=True)

from datetime import datetime
from sqlalchemy import DateTime

class Author_table(Base):
    __tablename__ = 'author_orm'
    user_id = Column(Integer(), primary_key=True)
    username = Column(String(15),nullable=False, unique=True)
    created_on = Column(DateTime(), default=datetime.now)
    updated_on = Column(DateTime(), default=datetime.now, onupdate=datetime.now)

db_url = "mysql+pymysql://root:''@localhost:3306/testdb?charset=utf8mb4"

# 创建表
engine = create_engine(db_url, echo=True, encoding="utf-8")

Base.metadata.create_all(engine)
```